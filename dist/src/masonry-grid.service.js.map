{"version":3,"file":"masonry-grid.service.js","sourceRoot":"","sources":["../../src/masonry-grid.service.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Shailendra Kumar <shailu.snist@gmail.com>\n * @ignore\n */\n\nimport { Injectable, ElementRef, PLATFORM_ID, Inject } from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common';\nimport { MasonryOptions, Masonry as IMasonry, AnimationOptions } from './masonry-grid.interface';\n\ndeclare var require: any;\n\n@Injectable()\nexport class MasonryGridService {\n\n  el: any;\n  masonryOptions: MasonryOptions;\n  animationOptions: AnimationOptions;\n  items: Array<any>;\n  itemsCount: number;\n  itemsRenderedCount: number;\n  didScroll: boolean;\n  resizeTimeout: any;\n  useAnimation: boolean;\n  isAnimate: boolean = false;\n  public _msnry: IMasonry;\n  public classie: any;\n  \n  docElem = window.document.documentElement;\n\n  animationDefaults: AnimationOptions = {\n    animationEffect: 'effect-1', // default animation effect-1 \n    // Minimum and a maximum duration of the animation (random value is chosen)\n    minDuration : 0,\n    maxDuration : 0,\n    // The viewportFactor defines how much of the appearing item has to be visible in order to trigger the animation\n    // if we'd use a value of 0, this would mean that it would add the animation class as soon as the item is in the viewport. \n    // If we were to use the value of 1, the animation would only be triggered when we see all of the item in the viewport (100% of it)\n    viewportFactor : 0\n  }\n\n  masonryDefaults:MasonryOptions = {\n    itemSelector: '[masonry-grid-item], masonry-grid-item' // Set default itemSelector: mandatory\n  }\n\n  constructor(\n    @Inject(PLATFORM_ID) private _platformId: any  ) \n  { }\n\n\n  getViewportH() {\n    var client = this.docElem['clientHeight'],\n      inner = window['innerHeight'];\n    \n    if( client < inner )\n      return inner;\n    else\n      return client;\n  }\n\n  scrollY() {\n    return window.pageYOffset || this.docElem.scrollTop;\n  }\n\n  getOffset( el:any ) {\n    var offsetTop = 0, offsetLeft = 0;\n    do {\n      if ( !isNaN( el.offsetTop ) ) {\n        offsetTop += el.offsetTop;\n      }\n      if ( !isNaN( el.offsetLeft ) ) {\n        offsetLeft += el.offsetLeft;\n      }\n    } while( el = el.offsetParent )\n\n    return {\n      top : offsetTop,\n      left : offsetLeft\n    }\n  }\n\n  inViewport( el:any, h?:any ) {\n    var elH = el.offsetHeight,\n      scrolled = this.scrollY(),\n      viewed = scrolled + this.getViewportH(),\n      elTop = this.getOffset(el).top,\n      elBottom = elTop + elH,\n      // if 0, the element is considered in the viewport as soon as it enters.\n      // if 1, the element is considered in the viewport only when it's fully inside\n      // value in percentage (1 >= h >= 0)\n      h = h || 0;\n\n    return (elTop + elH * h) <= viewed && (elBottom - elH * h) >= scrolled;\n  }\n\n  extend( a:any, b:any ) {\n    for( var key in b ) { \n      if( b.hasOwnProperty( key ) ) {\n        a[key] = b[key];\n      }\n    }\n    return a;\n  }\n\n  public init(useAnimation: boolean, el: any, masonryOptions: MasonryOptions, animationOptions: AnimationOptions): IMasonry {   \n    this.useAnimation = useAnimation;\n    this.el = el;\n    this.isAnimate = animationOptions ? true: false;\n    this.masonryOptions = this.extend(this.masonryDefaults, masonryOptions);\n    this.animationOptions = this.extend(this.animationDefaults, animationOptions) // this.extend( this.animationDefaults, animationOptions );\n    return this._init();\n  } \n\n  // Initialize Masonry\n  public initializeMasonry(_element: any, options: MasonryOptions): IMasonry {\n    const Masonry = require('masonry-layout');    \n    return new Masonry(_element, options); \n  }\n\n  private _init(): IMasonry {   \n    \n    // set margin bottom of gutter length.\n    if(this.masonryOptions.gutter) {\n      Array.prototype.slice.call(document.querySelectorAll(this.masonryDefaults.itemSelector)).forEach(element => {\n        element.style.marginBottom = this.masonryOptions.gutter + 'px';\n      });\n    } \n    \n    if (this.useAnimation || this.isAnimate) {\n      this.classie = require('desandro-classie');    \n      // add animation effect\n      this.el.classList += \" \"+ this.animationOptions.animationEffect;\n    }\n\n    if (isPlatformBrowser(this._platformId)) { \n          \n      // initialize masonry\n      this._msnry = this.initializeMasonry(this.el, this.masonryOptions);   \n\n      if (this.useAnimation || this.isAnimate && !this._msnry) {       \n\n        this._msnry.on('layoutComplete', (items: any) => {          \n          this.items = Array.prototype.slice.call( document.querySelectorAll( this.masonryDefaults.itemSelector) );\n          this.itemsCount = this.items.length;          \n          this.didScroll = false;\n          this.itemsRenderedCount = 0;\n          // the items already shown...\n          this.items.forEach( ( el, i ) => {                       \n            if( this.inViewport( el ) ) {\n              this._checkTotalRendered();\n              this.classie.add( el, 'shown' );\n              this.classie.remove( el, 'animate' );\n              //setTimeout(() => {\n                \n              //}, 1000);\n            }\n          });\n        });\n        \n        // animate on scroll the items inside the viewport\n        window.addEventListener( 'scroll', () => {\n          this._onScrollFn();\n        }, false );\n        window.addEventListener( 'resize', () => {\n          this._resizeHandler();\n        }, false );  \n           \n      }\n      \n      return this._msnry;  \n    }\n\n    return null;\n  }\n  \n  private _onScrollFn() {\n    var self = this;\n    if( !this.didScroll ) {\n      this.didScroll = true;\n      setTimeout( () => { self._scrollPage(); }, 60 );\n    }\n  }\n  \n  private _scrollPage () {\n    var self = this;\n    this.items.forEach( ( el, i ) => {\n      if( !this.classie.has( el, 'shown' ) && !this.classie.has( el, 'animate' ) && this.inViewport( el, self.animationOptions.viewportFactor ) ) {\n        setTimeout( () => {\n          var perspY = this.scrollY() + this.getViewportH() / 2;\n          self.el.style.WebkitPerspectiveOrigin = '50% ' + perspY + 'px';\n          self.el.style.MozPerspectiveOrigin = '50% ' + perspY + 'px';\n          self.el.style.perspectiveOrigin = '50% ' + perspY + 'px';\n\n          self._checkTotalRendered();\n\n          if( self.animationOptions.minDuration && self.animationOptions.maxDuration ) {\n            var randDuration = ( Math.random() * ( self.animationOptions.maxDuration - self.animationOptions.minDuration ) + self.animationOptions.minDuration ) + 's';\n            el.style.WebkitAnimationDuration = randDuration;\n            el.style.MozAnimationDuration = randDuration;\n            el.style.animationDuration = randDuration;\n          }\n          \n          this.classie.add( el, 'animate' );\n        }, 25 );\n      }\n    });\n    this.didScroll = false;\n  }\n  \n  private _resizeHandler() {\n    var self = this;\n    function delayed() {\n      self._scrollPage();\n      self.resizeTimeout = null;\n    }\n    if ( this.resizeTimeout ) {\n      clearTimeout( this.resizeTimeout );\n    }\n    this.resizeTimeout = setTimeout( delayed, 1000 );\n  }\n  \n  private _checkTotalRendered() {\n    ++this.itemsRenderedCount;\n    if( this.itemsRenderedCount === this.itemsCount ) {\n      window.removeEventListener( 'scroll', this._onScrollFn );\n      setTimeout(() => {\n        this._msnry.layout();\n      });\n    }\n  }\n\n}\n"]}